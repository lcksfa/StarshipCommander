{
  "id": "snapshot_1766397210250_rhkeg2nfe",
  "approvalId": "approval_1766397210247_of4bh29o3",
  "approvalTitle": "Starship Commander 实施任务分解文档",
  "version": 1,
  "timestamp": "2025-12-22T09:53:30.250Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Tasks Document - Starship Commander Core\n\n## Backend Implementation Tasks\n\n- [ ] 1. Update Prisma schema for frontend compatibility\n  - File: prisma/schema.prisma\n  - Update Mission, UserStats, UserMission, MissionHistory models\n  - Add category enum (BODY, BRAIN, BASE)\n  - Purpose: Align database schema with frontend data structures\n  - _Leverage: existing Prisma schema, frontend types in src/frontend/types.ts_\n  - _Requirements: 1, 2, 5_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Database Developer with Prisma expertise | Task: Update Prisma schema to match frontend Mission and UserStats interfaces, adding Category enum (BODY, BRAIN, BASE) and UserMission/MissionHistory tables for task completion tracking | Restrictions: Maintain backward compatibility, don't break existing migrations, ensure foreign key relationships are correct | Success: Schema compiles successfully, supports all frontend data structures, migration runs without errors_\n\n- [ ] 2. Create shared TypeScript types\n  - File: src/shared/types.ts\n  - Define Mission, UserStats, Category, LocalizedString interfaces\n  - Ensure type consistency between frontend and backend\n  - Purpose: Establish type safety across the full stack\n  - _Leverage: src/frontend/types.ts, existing backend types_\n  - _Requirements: 1, 2, 5_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: TypeScript Developer | Task: Create shared type definitions for Mission, UserStats, Category enum, and LocalizedString that match exactly with frontend interfaces, ensuring full-stack type consistency | Restrictions: Types must match frontend exactly, no breaking changes to existing code, maintain clear documentation | Success: Types compile without errors, provide complete type coverage, match frontend interfaces perfectly_\n\n- [ ] 3. Implement UserStats Service\n  - File: src/backend/modules/user-stats/user-stats.service.ts\n  - Create methods: getUserStats, updateUserStats, getMissionHistory\n  - Handle level progression and XP calculations\n  - Purpose: Manage user statistics and progression data\n  - _Leverage: existing tRPC service structure, Prisma client_\n  - _Requirements: 1, 4_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: NestJS Backend Developer | Task: Implement UserStatsService with methods for retrieving user stats, updating stats after mission completion, handling level calculations, and managing mission history, following NestJS service patterns | Restrictions: Must use dependency injection, follow existing service patterns, ensure data consistency, handle edge cases properly | Success: Service methods work correctly, XP and level calculations are accurate, mission history is properly tracked_\n\n- [ ] 4. Implement UserStats tRPC Router\n  - File: src/backend/modules/user-stats/user-stats.router.ts\n  - Create tRPC routes: getStats, updateStats, getHistory\n  - Add proper input validation with Zod schemas\n  - Purpose: Provide type-safe API endpoints for user statistics\n  - _Leverage: existing tRPC configuration, UserStatsService_\n  - _Requirements: 1, 4_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: tRPC Specialist | Task: Create tRPC router for user statistics with proper input validation, integrating with UserStatsService, ensuring type safety and following existing tRPC patterns in the codebase | Restrictions: Must use Zod for validation, follow existing router structure, maintain type consistency with frontend | Success: All endpoints work correctly, validation prevents invalid data, type safety is maintained end-to-end_\n\n- [ ] 5. Enhance Mission Service\n  - File: src/backend/modules/mission/mission.service.ts (extend existing)\n  - Add methods: getMissions, completeMission, createMission\n  - Implement cooldown logic and streak tracking\n  - Purpose: Manage task lifecycle and execution logic\n  - _Leverage: existing Mission module, Prisma models_\n  - _Requirements: 2, 3_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: NestJS Developer | Task: Enhance existing MissionService with methods for retrieving filtered missions, handling task completion with rewards and cooldowns, supporting user-created missions, and managing streak tracking | Restrictions: Must extend existing service without breaking current functionality, handle all edge cases, ensure transaction safety | Success: Mission lifecycle works correctly, cooldowns are enforced, streaks are tracked accurately, rewards are calculated properly_\n\n- [ ] 6. Enhance Mission tRPC Router\n  - File: src/backend/modules/mission/mission.router.ts (extend existing)\n  - Add routes: getMissions (with filters), completeMission, createMission\n  - Implement comprehensive input validation\n  - Purpose: Provide complete mission management API\n  - _Leverage: existing mission router, enhanced MissionService_\n  - _Requirements: 2, 3_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: tRPC API Developer | Task: Extend existing mission tRPC router with new endpoints for filtered mission retrieval, task completion with reward calculation, and user-created mission submission, with robust validation | Restrictions: Must maintain backward compatibility, use existing patterns, ensure all input is validated, return proper error messages | Success: All new endpoints work correctly, filters function properly, mission completion updates all related data correctly_\n\n- [ ] 7. Implement Sync Service\n  - File: src/backend/modules/sync/sync.service.ts\n  - Create methods: getSyncData, processOfflineActions\n  - Handle conflict resolution and data merging\n  - Purpose: Support offline usage and multi-device synchronization\n  - _Leverage: Prisma client, existing service patterns_\n  - _Requirements: 5_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Systems Developer | Task: Create SyncService with methods for data synchronization, offline action processing, conflict resolution using timestamps, and ensuring data consistency across devices | Restrictions: Must handle network failures gracefully, resolve conflicts intelligently, ensure no data loss, maintain performance | Success: Sync works reliably across devices, offline actions are processed correctly, conflicts are resolved automatically_\n\n- [ ] 8. Implement Sync tRPC Router\n  - File: src/backend/modules/sync/sync.router.ts\n  - Create routes: syncData, uploadOfflineActions\n  - Add batch processing support\n  - Purpose: Provide synchronization API endpoints\n  - _Leverage: SyncService, existing tRPC patterns_\n  - _Requirements: 5_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: tRPC Integration Specialist | Task: Create tRPC router for data synchronization with support for batch processing offline actions, handling large datasets efficiently, and providing sync status information | Restrictions: Must handle large datasets efficiently, support batch operations, provide clear sync status, handle timeouts gracefully | Success: Sync endpoints perform well, handle batch operations correctly, provide useful status information_\n\n- [ ] 9. Update Main tRPC Router\n  - File: src/backend/trpc/trpc.service.ts (modify existing)\n  - Register new routers (user, mission, sync)\n  - Update app router configuration\n  - Purpose: Expose all new endpoints through tRPC\n  - _Leverage: existing tRPC service structure_\n  - _Requirements: All API requirements_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: tRPC Integration Developer | Task: Update main tRPC router to include new user, mission, and sync routers, ensuring proper routing structure and maintaining existing functionality | Restrictions: Must not break existing endpoints, follow established router organization, maintain backward compatibility | Success: All new endpoints are accessible, existing functionality remains intact, router structure is clean and maintainable_\n\n- [ ] 10. Create Database Seed Data\n  - File: prisma/seed.ts (extend existing)\n  - Add sample missions for BODY, BRAIN, BASE categories\n  - Create test user with sample stats\n  - Purpose: Provide development and testing data\n  - _Leverage: existing seed file structure_\n  - _Requirements: Development support_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Database Engineer | Task: Extend seed data with diverse missions across all categories (BODY, BRAIN, BASE), realistic XP and coin rewards, proper multi-language content, and test users with various stats | Restrictions: Must follow existing seed format, provide realistic data, include edge cases for testing, maintain data consistency | Success: Seed data populates correctly, provides good test coverage, supports both development and testing scenarios_\n\n## Frontend Integration Tasks\n\n- [ ] 11. Create tRPC Client Configuration\n  - File: src/frontend/lib/trpc.ts\n  - Set up tRPC client with proper type linking\n  - Configure React Query integration\n  - Purpose: Enable type-safe API calls from frontend\n  - _Leverage: existing React setup, tRPC client patterns_\n  - _Requirements: 1, 2, 4, 5_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Integration Developer | Task: Create tRPC client configuration with full type safety, React Query integration for caching and optimistic updates, proper error handling, and loading states | Restrictions: Must maintain type safety with backend, handle network errors gracefully, provide good UX for loading states | Success: Frontend can call all backend APIs with type safety, caching works properly, errors are handled gracefully_\n\n- [ ] 12. Update App Component State Management\n  - File: src/frontend/App.tsx (modify existing)\n  - Replace mock data with tRPC Query hooks\n  - Integrate real API calls for missions and stats\n  - Purpose: Connect frontend to live backend data\n  - _Leverage: existing App component, new tRPC client_\n  - _Requirements: 1, 2, 4_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React State Management Expert | Task: Update App component to use tRPC Query hooks instead of mock data, implement proper loading and error states, maintain existing UI/UX while connecting to real backend | Restrictions: Must maintain existing UI/UX, handle loading states gracefully, provide offline fallbacks, don't break existing functionality | Success: App works with real backend data, loading states are handled well, user experience is smooth and responsive_\n\n- [ ] 13. Update Mission Card Component\n  - File: src/frontend/components/MissionCard.tsx (modify existing)\n  - Connect mission completion to real API\n  - Add cooldown state handling\n  - Purpose: Integrate task execution with backend\n  - _Leverage: existing MissionCard component, tRPC mutations_\n  - _Requirements: 2, 3_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Component Developer | Task: Update MissionCard to use real API for mission completion, handle cooldown states properly, maintain existing UI while adding backend integration, handle success/error states | Restrictions: Must maintain existing visual design, handle API failures gracefully, provide immediate feedback for user actions | Success: Mission completion works with real backend, cooldown states display correctly, user feedback is immediate and clear_\n\n- [ ] 14. Update HUD Component\n  - File: src/frontend/components/HUD.tsx (modify existing)\n  - Connect user stats to real API data\n  - Add real-time updates for level progression\n  - Purpose: Display live user statistics from backend\n  - _Leverage: existing HUD component, tRPC Query hooks_\n  - _Requirements: 1, 4_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React UI Developer | Task: Update HUD component to display real user stats from backend, handle level progression animations, maintain existing design while adding live data updates | Restrictions: Must maintain existing visual design, handle data updates smoothly, provide good performance for frequent updates | Success: HUD displays real-time user stats, level changes are animated smoothly, performance remains excellent_\n\n- [ ] 15. Update Success Overlay Component  \n  - File: src/frontend/components/SuccessOverlay.tsx (modify existing)\n  - Connect reward display to real API responses\n  - Add level up celebration integration\n  - Purpose: Show actual rewards earned from mission completion\n  - _Leverage: existing SuccessOverlay component, mission completion API_\n  - _Requirements: 4_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: React Animation Developer | Task: Update SuccessOverlay to display actual rewards from API, integrate level up celebrations, maintain existing animations while showing real data | Restrictions: Must maintain existing animation quality, handle edge cases in reward calculations, ensure smooth transitions | Success: Overlay shows correct rewards from backend, level up animations trigger properly, user experience is celebratory and smooth_\n\n## Testing Tasks\n\n- [ ] 16. Create Backend Unit Tests\n  - Files: src/backend/modules/**/*.spec.ts\n  - Test service methods and business logic\n  - Mock database operations\n  - Purpose: Ensure backend reliability and correctness\n  - _Leverage: existing NestJS testing setup, Jest framework_\n  - _Requirements: 1, 2, 3, 4, 5_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Backend Testing Engineer | Task: Create comprehensive unit tests for all new services and business logic, mock database operations properly, test edge cases and error scenarios, achieve good code coverage | Restrictions: Must test all public methods, mock external dependencies, test both success and failure cases, maintain test isolation | Success: All services have comprehensive tests, edge cases are covered, tests run reliably and quickly_\n\n- [ ] 17. Create API Integration Tests\n  - Files: tests/api/**/*.test.ts\n  - Test all tRPC endpoints end-to-end\n  - Use test database with fixtures\n  - Purpose: Verify API functionality and data flow\n  - _Leverage: existing testing infrastructure, Prisma test environment_\n  - _Requirements: 1, 2, 3, 4, 5_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: API Testing Specialist | Task: Create integration tests for all tRPC endpoints, test complete request/response cycles, use test database with realistic fixtures, verify data consistency | Restrictions: Must test complete workflows, use separate test database, clean up test data properly, verify all business rules | Success: All endpoints are tested end-to-end, data consistency is verified, tests are reliable and maintainable_\n\n- [ ] 18. Create Frontend Component Tests\n  - Files: src/frontend/components/**/*.test.tsx\n  - Test React components with mocked API\n  - Verify UI updates and user interactions\n  - Purpose: Ensure frontend components work correctly\n  - _Leverage: existing React Testing Library setup_\n  - _Requirements: 1, 2, 4_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Frontend Testing Engineer | Task: Create tests for updated React components, mock tRPC calls properly, verify UI state changes and user interactions, test loading and error states | Restrictions: Must mock external dependencies, test user interactions thoroughly, verify accessibility, maintain test reliability | Success: All component interactions are tested, loading states work correctly, error handling is verified_\n\n## Documentation and Deployment Tasks\n\n- [ ] 19. Update API Documentation\n  - File: docs/api.md (create new)\n  - Document all tRPC endpoints and types\n  - Provide usage examples\n  - Purpose: Create comprehensive API documentation\n  - _Leverage: tRPC auto-generated types, existing Swagger setup_\n  - _Requirements: Documentation_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: Technical Writer | Task: Create comprehensive API documentation covering all tRPC endpoints, including type definitions, usage examples, error handling, and best practices for frontend integration | Restrictions: Must be accurate and up-to-date, include practical examples, document error scenarios, maintain consistency with existing docs | Success: Documentation is complete and accurate, developers can easily understand and use the API, examples are practical and tested_\n\n- [ ] 20. Create Deployment Guide\n  - File: docs/deployment.md (create new)\n  - Document environment setup and deployment process\n  - Include database migration steps\n  - Purpose: Provide clear deployment instructions\n  - _Leverage: existing package.json scripts, deployment patterns_\n  - _Requirements: Deployment support_\n  - _Prompt: Implement the task for spec starship-commander-core, first run spec-workflow-guide to get the workflow guide then implement the task: Role: DevOps Documentation Specialist | Task: Create deployment guide covering environment setup, database migrations, build processes, and production deployment steps, including troubleshooting common issues | Restrictions: Must cover all deployment steps, include security considerations, provide rollback procedures, document monitoring needs | Success: Deployment process is well-documented, team can deploy confidently, troubleshooting information is comprehensive_",
  "fileStats": {
    "size": 18904,
    "lines": 189,
    "lastModified": "2025-12-22T09:53:19.611Z"
  },
  "comments": []
}