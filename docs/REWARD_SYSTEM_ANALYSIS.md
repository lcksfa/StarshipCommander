# Starship Commander - å¥–åŠ±ç³»ç»Ÿæ•°å€¼å¹³è¡¡åˆ†æ

> **åˆ†ææ—¥æœŸ**: 2025-12-24
> **åˆ†æç›®æ ‡**: è°ƒæ•´ UI å’Œæ˜Ÿå¸(CR)/ç»éªŒ(XP)è·å–æ•°å€¼ï¼ŒåŒ¹é… requirements.md éœ€æ±‚
> **å½“å‰åˆ†æ”¯**: `feature/reward-system-balance`

---

## ğŸ“Š ç›®å½•

1. [å½“å‰å®ç°åˆ†æ](#å½“å‰å®ç°åˆ†æ)
2. [é—®é¢˜æ€»ç»“](#é—®é¢˜æ€»ç»“)
3. [æ–°ç³»ç»Ÿè®¾è®¡](#æ–°ç³»ç»Ÿè®¾è®¡)
4. [æ–°æ—§ç³»ç»Ÿå¯¹æ¯”](#æ–°æ—§ç³»ç»Ÿå¯¹æ¯”)
5. [å®æ–½è®¡åˆ’](#å®æ–½è®¡åˆ’)
6. [éªŒæ”¶æ ‡å‡†](#éªŒæ”¶æ ‡å‡†)

---

## ğŸ“Š å½“å‰å®ç°åˆ†æ

### 1. ç­‰çº§ç³»ç»Ÿ (src/backend/services/mission.service.ts:782)

```typescript
private calculateLevel(totalXp: number): number {
  // ç®€å•çš„ç­‰çº§è®¡ç®—å…¬å¼ï¼šæ¯100ç‚¹XPå‡ä¸€çº§
  return Math.floor(totalXp / 100) + 1;
}
```

**é—®é¢˜**:
- âœ… ç­‰çº§è®¡ç®—æ­£ç¡®ï¼ˆæ¯ 100 XP å‡ä¸€çº§ï¼‰
- âŒ `currentXp` è®¡ç®—é”™è¯¯ï¼ˆæœªå¤„ç†å‡çº§åçš„é‡ç½®ï¼‰
- âŒ `maxXp` å­—æ®µå­˜åœ¨ä½†ä»æœªæ›´æ–°
- âŒ **å›ºå®šæ¯çº§ 100 XPï¼Œç¼ºä¹æˆé•¿æ„Ÿ**

### 2. å¥–åŠ±é…ç½® (src/backend/config/mission-rules.ts)

| éš¾åº¦ | æœ€å°å¥–åŠ± | æœ€å¤§å¥–åŠ± | æ¨èå€¼ |
|------|---------|---------|--------|
| **EASY** | 10 XP, 5 CR | 50 XP, 25 CR | **25 XP, 10 CR** |
| **MEDIUM** | 30 XP, 15 CR | 150 XP, 75 CR | **75 XP, 30 CR** |
| **HARD** | 100 XP, 50 CR | 500 XP, 250 CR | **200 XP, 100 CR** |

**é—®é¢˜**:
- âŒ HARD ä»»åŠ¡å‡çº§å¤ªå¿«ï¼ˆ0.5ä¸ªä»»åŠ¡å°±å‡çº§ï¼‰
- âŒ MEDIUM ä»»åŠ¡ä¹Ÿåå¿«ï¼ˆ1.33ä¸ªä»»åŠ¡ï¼‰
- âš ï¸ EASY ä»»åŠ¡ç›¸å¯¹åˆç†

### 3. å†›è¡”ç³»ç»Ÿ (src/frontend/constants.ts)

```typescript
export const RANKS = [
  "Cadet",          // Level 1
  "Ensign",         // Level 2-3
  "Lieutenant",     // Level 4-6
  "Commander",      // Level 7-10
  "Captain",        // Level 11-15
  "Admiral",        // Level 16-20
  "Galactic Hero",  // Level 21+
];
```

**é—®é¢˜**: å†›è¡”ä¸ç­‰çº§æ²¡æœ‰å¯¹åº”å…³ç³»ï¼Œåªæ˜¯é™æ€åˆ—è¡¨

### 4. æ•°æ®åº“å­—æ®µ (prisma/schema.prisma)

```prisma
model UserStats {
  level     Int @default(1)
  currentXp Int @default(0)
  maxXp     Int @default(100)
  ...
}
```

**é—®é¢˜**: `maxXp` å­—æ®µå›ºå®šä¸º 100ï¼Œæœªéšç­‰çº§å˜åŒ–

---

## âŒ é—®é¢˜æ€»ç»“

### æ ¸å¿ƒé—®é¢˜

1. **å›ºå®šå‡çº§é˜ˆå€¼** - æ¯çº§éƒ½æ˜¯ 100 XPï¼Œé«˜ç­‰çº§å¤±å»æŒ‘æˆ˜æ€§
2. **å¥–åŠ±æ•°å€¼ä¸åˆç†** - HARD ä»»åŠ¡å¥–åŠ±è¿‡é«˜ï¼Œå¯¼è‡´å‡çº§å¤ªå¿«
3. **currentXp è®¡ç®—é”™è¯¯** - æœªå¤„ç†å‡çº§åçš„é‡ç½®
4. **å†›è¡”ç³»ç»Ÿæœªå…³è”** - Rank ä¸ Level æ²¡æœ‰åŠ¨æ€å…³è”

### å½±å“

- âŒ æ–°æ‰‹ä½“éªŒï¼šå¿«é€Ÿå‡çº§ä½†ç¼ºä¹æˆå°±æ„Ÿ
- âŒ ä¸­æœŸä½“éªŒï¼šå‡çº§é€Ÿåº¦å•è°ƒï¼Œå¤±å»å‚ä¸åº¦
- âŒ åæœŸä½“éªŒï¼šé«˜ç­‰çº§æ¯«æ— æŒ‘æˆ˜ï¼Œå¤±å»é•¿æœŸç›®æ ‡
- âŒ UI æ˜¾ç¤ºï¼šä¸ç¬¦åˆ "Level N // RankName" æ ¼å¼è¦æ±‚

---

## ğŸ¯ æ–°ç³»ç»Ÿè®¾è®¡

### è®¾è®¡åŸåˆ™

1. **æ–°æ‰‹å‹å¥½** (Level 1-10): å¿«é€Ÿå‡çº§ï¼Œå»ºç«‹ä¿¡å¿ƒå’ŒåŠ¨åŠ›
2. **æ¸è¿›éš¾åº¦** (Level 11-25): é€‚ä¸­æŒ‘æˆ˜ï¼Œä¿æŒå‚ä¸åº¦
3. **é•¿æœŸç›®æ ‡** (Level 26-40): çœŸæ­£çš„æŒ‘æˆ˜ï¼Œæä¾›é•¿æœŸç›®æ ‡
4. **ä¼ å¥‡æŒ‘æˆ˜** (Level 41+): ç»ˆæç›®æ ‡ï¼Œè£èª‰è±¡å¾

### æ¸è¿›å¼ç­‰çº§ç³»ç»Ÿ

#### XP éœ€æ±‚æ›²çº¿

```typescript
Level 1-2:   50 XP   (å¿«é€Ÿå»ºç«‹ä¿¡å¿ƒ)
Level 2-3:   70 XP   (+40%)
Level 3-4:   80 XP   (+14%)
Level 4-5:   100 XP  (+25%)
Level 5-6:   120 XP  (+20%)
Level 6-7:   140 XP  (+17%)
Level 7-8:   160 XP  (+14%)
Level 8-9:   180 XP  (+13%)
Level 9-10:  200 XP  (+11%)
Level 10-11: 250 XP  (+25%)
...
Level 25-26: 900 XP  (é•¿æœŸç›®æ ‡)
Level 40-41: 2400 XP (ä¼ å¥‡æŒ‘æˆ˜)
```

#### å®Œæ•´ç­‰çº§é˜ˆå€¼è¡¨ (å‰50çº§)

| ç­‰çº§ | æ‰€éœ€æ€» XP | æœ¬çº§éœ€ XP | å†›è¡” |
|------|----------|---------|------|
| **1** | 0 | 50 | Cadet |
| **2** | 50 | 70 | Cadet |
| **3** | 120 | 80 | Ensign |
| **4** | 200 | 100 | Ensign |
| **5** | 300 | 120 | Lieutenant |
| **6** | 420 | 140 | Lieutenant |
| **7** | 560 | 160 | Lieutenant |
| **8** | 720 | 180 | Lieutenant |
| **9** | 900 | 200 | Commander |
| **10** | 1100 | 250 | Commander |
| **11** | 1350 | 270 | Commander |
| **12** | 1620 | 300 | Commander |
| **13** | 1920 | 330 | Commander |
| **14** | 2250 | 350 | Captain |
| **15** | 2600 | 400 | Captain |
| **16** | 3000 | 450 | Captain |
| **17** | 3450 | 500 | Captain |
| **18** | 3950 | 550 | Captain |
| **19** | 4500 | 600 | Admiral |
| **20** | 5100 | 650 | Admiral |
| **21** | 5750 | 700 | Admiral |
| **22** | 6450 | 750 | Admiral |
| **23** | 7200 | 800 | Admiral |
| **24** | 8000 | 850 | Admiral |
| **25** | 8850 | 900 | Admiral |
| **26** | 9750 | 950 | Admiral |
| **27** | 10700 | 1000 | Galactic Hero |
| ... | ... | ... | ... |
| **30** | 13850 | 1150 | Galactic Hero |
| ... | ... | ... | ... |
| **40** | 27600 | 2400 | Galactic Hero |
| **41** | 30000 | 2500 | Galactic Legend |
| ... | ... | ... | ... |
| **50** | 56100 | 2600 | Galactic Legend |

#### å†›è¡”æ˜ å°„

```
Level 1-2:    Cadet            // å­¦å‘˜ - åˆšå¼€å§‹æ—…ç¨‹
Level 3-4:    Ensign           // å°‘å°‰ - å…·å¤‡åŸºç¡€èƒ½åŠ›
Level 5-8:    Lieutenant       // ä¸­å°‰ - ç»éªŒä¸°å¯Œçš„å†›å®˜
Level 9-13:   Commander         // æŒ‡æŒ¥å®˜ - èƒ½ç‹¬å½“ä¸€é¢
Level 14-20:  Captain          // èˆ°é•¿ - æŒ‡æŒ¥å¤§å‹èˆ°é˜Ÿ
Level 21-27:  Admiral          // ä¸Šå°† - æœ€é«˜æŒ‡æŒ¥å®˜
Level 28-40:  Galactic Hero    // é“¶æ²³è‹±é›„ - ä¼ å¥‡äººç‰©
Level 41+:    Galactic Legend  // é“¶æ²³ä¼ å¥‡ - æ°¸æ’è£è€€
```

---

## ğŸ’¡ æ–°å¥–åŠ±é…ç½®

### è°ƒæ•´åçš„å¥–åŠ±æ•°å€¼

| éš¾åº¦ | æ—§æ¨è | **æ–°æ¨è** | å˜åŒ– |
|------|-------|----------|------|
| **EASY** | 25 XP, 10 CR | **12 XP, 6 CR** | -52% XP, -40% CR |
| **MEDIUM** | 75 XP, 30 CR | **30 XP, 15 CR** | -60% XP, -50% CR |
| **HARD** | 200 XP, 100 CR | **60 XP, 30 CR** | -70% XP, -70% CR |

### å‡çº§é€Ÿåº¦å¯¹æ¯” (æ–°ç³»ç»Ÿ)

#### æ—©æœŸæ¸¸æˆ (Level 1-5)

| ç­‰çº§ | æ‰€éœ€ XP | EASY ä»»åŠ¡ | MEDIUM ä»»åŠ¡ | HARD ä»»åŠ¡ |
|------|---------|----------|-----------|-----------|
| 1â†’2  | 50 XP   | **4 ä¸ª**  | **2 ä¸ª**   | **1 ä¸ª**   |
| 2â†’3  | 70 XP   | 6 ä¸ª      | 3 ä¸ª       | 2 ä¸ª       |
| 3â†’4  | 80 XP   | 7 ä¸ª      | 3 ä¸ª       | 2 ä¸ª       |
| 4â†’5  | 100 XP  | 8 ä¸ª      | 4 ä¸ª       | 2 ä¸ª       |

**ä½“éªŒ**: ç¬¬ä¸€çº§å¿«é€Ÿå‡çº§ï¼ˆ4ä¸ªEASYä»»åŠ¡ï¼‰ï¼Œå»ºç«‹ä¿¡å¿ƒ

#### ä¸­æœŸæ¸¸æˆ (Level 10-15)

| ç­‰çº§ | æ‰€éœ€ XP | EASY ä»»åŠ¡ | MEDIUM ä»»åŠ¡ | HARD ä»»åŠ¡ |
|------|---------|----------|-----------|-----------|
| 10â†’11 | 250 XP  | **21 ä¸ª** | **8 ä¸ª**   | **4 ä¸ª**   |
| 11â†’12 | 270 XP  | 23 ä¸ª     | 9 ä¸ª       | 5 ä¸ª       |
| 12â†’13 | 300 XP  | 25 ä¸ª     | 10 ä¸ª      | 5 ä¸ª       |
| 13â†’14 | 330 XP  | 28 ä¸ª     | 11 ä¸ª      | 6 ä¸ª       |
| 14â†’15 | 350 XP  | 29 ä¸ª     | 12 ä¸ª      | 6 ä¸ª       |

**ä½“éªŒ**: éš¾åº¦é€æ¸å¢åŠ ï¼Œéœ€è¦æ›´å¤šåŠªåŠ›

#### åæœŸæ¸¸æˆ (Level 25+)

| ç­‰çº§ | æ‰€éœ€ XP | EASY ä»»åŠ¡ | MEDIUM ä»»åŠ¡ | HARD ä»»åŠ¡ |
|------|---------|----------|-----------|-----------|
| 25â†’26 | 900 XP  | **75 ä¸ª** | **30 ä¸ª**  | **15 ä¸ª**  |
| 30â†’31 | 1150 XP | 96 ä¸ª     | 38 ä¸ª      | 19 ä¸ª      |
| 40â†’41 | 2400 XP | 200 ä¸ª    | 80 ä¸ª      | 40 ä¸ª      |

**ä½“éªŒ**: çœŸæ­£çš„é•¿æœŸæŒ‘æˆ˜

### å®é™…æ¸¸æˆä½“éªŒç¤ºä¾‹

#### æ–°æ‰‹ç¬¬ä¸€å¤© (æ–°ç³»ç»Ÿ)

```
å¼€å§‹: Level 1, 0 XP
å®Œæˆ 4 ä¸ª EASY ä»»åŠ¡: +48 XP
å®Œæˆ 1 ä¸ª MEDIUM ä»»åŠ¡: +30 XP
-----------------------
ç¬¬ä¸€å¤©ç»“æŸ: Level 2 (78 XP / 120 XP)

âœ… ä½“éªŒ: å¿«é€Ÿå‡çº§åˆ° Level 2ï¼Œå»ºç«‹æˆå°±æ„Ÿ
```

#### ä¸­æœŸç©å®¶ (Level 10)

```
å½“å‰: Level 10, 1100 XP
éœ€è¦ 250 XP åˆ° Level 11
-----------------------
å®Œæˆ 4 ä¸ª EASY ä»»åŠ¡: +48 XP
å®Œæˆ 2 ä¸ª MEDIUM ä»»åŠ¡: +60 XP
å®Œæˆ 1 ä¸ª HARD ä»»åŠ¡: +60 XP
-----------------------
æ€»è®¡: +168 XP (è¿˜éœ€ 82 XP)

âœ… ä½“éªŒ: éœ€è¦æ›´å¤šåŠªåŠ›ï¼Œå‡çº§æ›´æœ‰æ„ä¹‰
```

#### é«˜çº§ç©å®¶ (Level 25+)

```
å½“å‰: Level 25, 8850 XP
éœ€è¦ 900 XP åˆ° Level 26
-----------------------
å®Œæˆ 20 ä¸ª EASY ä»»åŠ¡: +240 XP
å®Œæˆ 10 ä¸ª MEDIUM ä»»åŠ¡: +300 XP
å®Œæˆ 5 ä¸ª HARD ä»»åŠ¡: +300 XP
-----------------------
æ€»è®¡: +840 XP (è¿˜éœ€ 60 XP)

âœ… ä½“éªŒ: çœŸæ­£çš„æŒ‘æˆ˜ï¼Œé•¿æœŸç›®æ ‡æ„Ÿ
```

---

## ğŸ“Š æ–°æ—§ç³»ç»Ÿå¯¹æ¯”

### ç³»ç»Ÿç‰¹æ€§å¯¹æ¯”

| æŒ‡æ ‡ | æ—§ç³»ç»Ÿ | æ–°ç³»ç»Ÿ | æ”¹è¿› |
|------|-------|--------|------|
| **ç¬¬ä¸€çº§å‡çº§** | 100 XP | 50 XP | âœ… å¿« 100% |
| **ç¬¬10çº§å‡çº§** | 100 XP | 250 XP | âœ… éš¾ 150% |
| **ç¬¬25çº§å‡çº§** | 100 XP | 900 XP | âœ… éš¾ 800% |
| **ç¬¬50çº§å‡çº§** | 100 XP | 2400 XP | âœ… éš¾ 2300% |
| **å†›è¡”ç³»ç»Ÿ** | âŒ æ— å…³è” | âœ… 7 ä¸ªé˜¶å±‚ | âœ… å®Œæ•´ |
| **é•¿æœŸæŒ‘æˆ˜** | âŒ ç¼ºä¹ | âœ… å……è¶³ | âœ… æ˜æ˜¾ |

### UI æ˜¾ç¤ºæ•ˆæœå¯¹æ¯”

#### æ—§ç³»ç»Ÿ
```
Level 5
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80/100 XP (80%)
```

#### æ–°ç³»ç»Ÿ
```
Level 5 // Lieutenant
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80/120 XP (67%)
Next: Commander (Level 9)
```

**ä¼˜åŠ¿**:
- âœ… æ˜¾ç¤ºå½“å‰å†›è¡”
- âœ… æ˜¾ç¤ºä¸‹ä¸€çº§ç›®æ ‡
- âœ… æ›´æœ‰æ²‰æµ¸æ„Ÿ

### å‡çº§æ›²çº¿å¯è§†åŒ–

```
æ—§ç³»ç»Ÿ (å›ºå®š100 XP/çº§):
XP â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    â†‘          â†‘           â†‘
  Lv2        Lv5         Lv10
 (100)      (500)       (1000)

æ–°ç³»ç»Ÿ (æ¸è¿›å¼):
XP â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    â†‘    â†‘â†‘    â†‘â†‘â†‘    â†‘â†‘â†‘â†‘
  Lv2  Lv5  Lv10  Lv15  Lv25
 (50) (300)(1100)(2250)(8850)
      â””â”€â”€ å¿«é€Ÿå»ºç«‹ä¿¡å¿ƒ â”€â”€â”˜
              â””â”€â”€ æŒç»­æˆé•¿ â”€â”€â”˜
                      â””â”€â”€ é•¿æœŸæŒ‘æˆ˜ â”€â”€â”˜
```

---

## ğŸ”§ å®æ–½è®¡åˆ’

### Phase 1: ä¿®å¤ç­‰çº§è®¡ç®—é€»è¾‘ âš ï¸ **æœ€é«˜ä¼˜å…ˆçº§**

**æ–‡ä»¶**: `src/backend/services/mission.service.ts`

**å½“å‰é”™è¯¯ä»£ç ** (line 361-368):
```typescript
// âŒ é”™è¯¯å®ç°
await tx.userStats.update({
  where: { userId },
  data: {
    currentXp: userStats.currentXp + mission.xpReward,  // é”™è¯¯ï¼
    totalXpEarned: newTotalXp,
    level: newLevel,
  },
});
```

**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// âœ… æ­£ç¡®å®ç°
// 1. ä½¿ç”¨æ–°çš„ç­‰çº§ç³»ç»Ÿé…ç½®
import { calculateLevelProgress } from '../config/level-system';

// 2. è®¡ç®—æ­£ç¡®çš„ç­‰çº§è¿›åº¦
const levelProgress = calculateLevelProgress(newTotalXp);

await tx.userStats.update({
  where: { userId },
  data: {
    currentXp: levelProgress.currentXp,
    maxXp: levelProgress.maxXp,
    totalXpEarned: newTotalXp,
    level: levelProgress.level,
    rank: calculateRank(levelProgress.level),  // æ·»åŠ å†›è¡”
  },
});
```

**é¢„è®¡å·¥ä½œé‡**: 1-2 å°æ—¶

---

### Phase 2: é›†æˆæ–°çš„ç­‰çº§ç³»ç»Ÿé…ç½®

**å·²å®Œæˆ**: âœ… `src/backend/config/level-system.ts` (å·²åˆ›å»º)

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… `LEVEL_THRESHOLDS` - å®Œæ•´çš„ç­‰çº§é˜ˆå€¼è¡¨ï¼ˆ50çº§ï¼‰
- âœ… `calculateRank()` - æ ¹æ®ç­‰çº§è®¡ç®—å†›è¡”
- âœ… `calculateLevel()` - æ ¹æ®æ€»XPè®¡ç®—ç­‰çº§
- âœ… `calculateLevelProgress()` - è®¡ç®—å½“å‰ç­‰çº§è¿›åº¦
- âœ… `formatLevelDisplay()` - æ ¼å¼åŒ–æ˜¾ç¤º "Level N // Rank"
- âœ… `getLevelTier()` - è·å–ç­‰çº§é˜¶ä½ï¼ˆç”¨äºç‰¹æ®Šå¥–åŠ±ï¼‰

**å¾…é›†æˆ**: åœ¨ MissionService ä¸­å¯¼å…¥å’Œä½¿ç”¨è¿™äº›å‡½æ•°

**é¢„è®¡å·¥ä½œé‡**: 30 åˆ†é’Ÿ

---

### Phase 3: æ›´æ–°ç§å­æ•°æ®

**æ–‡ä»¶**: `prisma/seed.ts`

**éœ€è¦æ›´æ–°**:
1. ä½¿ç”¨æ–°çš„å¥–åŠ±æ¨èå€¼ï¼ˆEASY: 12 XP, MEDIUM: 30 XP, HARD: 60 XPï¼‰
2. ä½¿ç”¨æ–°çš„å†›è¡”æ˜ å°„
3. ç¡®ä¿ç¤ºä¾‹ç”¨æˆ·æœ‰åˆç†çš„ç­‰çº§è¿›åº¦

**é¢„è®¡å·¥ä½œé‡**: 30 åˆ†é’Ÿ

---

### Phase 4: å‰ç«¯ UI é€‚é…

**æ–‡ä»¶**:
- `src/frontend/constants.ts`
- `src/frontend/components/Hangar.tsx`
- `src/frontend/lib/trpc.ts`

**éœ€è¦æ›´æ–°**:
1. ç§»é™¤é™æ€ `RANKS` æ•°ç»„ï¼Œä½¿ç”¨åŠ¨æ€è®¡ç®—
2. æ›´æ–°ç­‰çº§æ˜¾ç¤ºæ ¼å¼ä¸º "Level N // RankName"
3. ä¿®å¤ XP è¿›åº¦æ¡è®¡ç®—é€»è¾‘
4. æ·»åŠ ä¸‹ä¸€çº§ç›®æ ‡æç¤º

**é¢„è®¡å·¥ä½œé‡**: 1-2 å°æ—¶

---

## ğŸ“‹ æ•°æ®åº“è¿ç§»è„šæœ¬

å¦‚æœå·²æœ‰ç”¨æˆ·æ•°æ®ï¼Œéœ€è¦è¿è¡Œè¿ç§»è„šæœ¬ï¼š

```sql
-- é‡æ–°è®¡ç®—æ‰€æœ‰ç”¨æˆ·çš„ç­‰çº§å’Œè¿›åº¦
-- Recalculate level and progress for all users

UPDATE user_stats
SET
  -- ä½¿ç”¨æ–°çš„ç­‰çº§ç³»ç»Ÿé‡æ–°è®¡ç®—ç­‰çº§
  level = CASE
    WHEN totalXpEarned < 50 THEN 1
    WHEN totalXpEarned < 120 THEN 2
    WHEN totalXpEarned < 200 THEN 3
    WHEN totalXpEarned < 300 THEN 4
    WHEN totalXpEarned < 420 THEN 5
    WHEN totalXpEarned < 560 THEN 6
    WHEN totalXpEarned < 720 THEN 7
    WHEN totalXpEarned < 900 THEN 8
    WHEN totalXpEarned < 1100 THEN 9
    WHEN totalXpEarned < 1350 THEN 10
    WHEN totalXpEarned < 1620 THEN 11
    WHEN totalXpEarned < 1920 THEN 12
    WHEN totalXpEarned < 2250 THEN 13
    WHEN totalXpEarned < 2600 THEN 14
    WHEN totalXpEarned < 3000 THEN 15
    -- ... æ›´å¤šç­‰çº§
    ELSE 50
  END,
  -- è®¡ç®—å½“å‰ç­‰çº§å†…çš„ XPï¼ˆéœ€è¦ä»é˜ˆå€¼è¡¨æŸ¥æ‰¾ï¼‰
  currentXp = totalXpEarned - (
    CASE
      WHEN totalXpEarned < 50 THEN 0
      WHEN totalXpEarned < 120 THEN 50
      WHEN totalXpEarned < 200 THEN 120
      -- ... æ›´å¤šé˜ˆå€¼
      ELSE 0
    END
  ),
  -- è®¡ç®—å½“å‰ç­‰çº§çš„æœ€å¤§ XP
  maxXp = (
    CASE
      WHEN totalXpEarned < 120 THEN 70
      WHEN totalXpEarned < 200 THEN 80
      -- ... æ›´å¤šé˜ˆå€¼
      ELSE 1000
    END
  );
```

**æ³¨æ„**: å®Œæ•´çš„è¿ç§»è„šæœ¬éœ€è¦åœ¨å®æ–½æ—¶ç¼–å†™

---

## âœ… éªŒæ”¶æ ‡å‡†

å®Œæˆä¼˜åŒ–åï¼Œç³»ç»Ÿåº”æ»¡è¶³ä»¥ä¸‹æ ‡å‡†ï¼š

### åŠŸèƒ½æ€§
1. âœ… `currentXp` æ­£ç¡®åæ˜ å½“å‰ç­‰çº§å†…çš„è¿›åº¦ï¼ˆ0 åˆ° maxXp-1ï¼‰
2. âœ… `maxXp` éšç­‰çº§åŠ¨æ€è°ƒæ•´ï¼ˆä¸æ˜¯å›ºå®š100ï¼‰
3. âœ… Level Up æ—¶æ­£ç¡®é‡ç½® `currentXp`ï¼ˆä¸æ˜¯ç´¯åŠ ï¼‰
4. âœ… `rank` å­—æ®µä¸ `level` æ­£ç¡®å…³è”

### UI æ˜¾ç¤º
5. âœ… Dashboard æ˜¾ç¤º "Level N // RankName" æ ¼å¼
6. âœ… XP è¿›åº¦æ¡æ˜¾ç¤ºå‡†ç¡®çš„ç™¾åˆ†æ¯” (currentXp / maxXp * 100)
7. âœ… è¿›åº¦æ¡ä¸‹æ–¹æ˜¾ç¤ºä¸‹ä¸€çº§ç›®æ ‡ï¼ˆå¦‚ "Next: Commander (Level 9)"ï¼‰

### æ¸¸æˆæ€§
8. âœ… Level 1-2: 4 ä¸ª EASY ä»»åŠ¡å‡çº§ï¼ˆæ–°æ‰‹å‹å¥½ï¼‰
9. âœ… Level 10: 21 ä¸ª EASY ä»»åŠ¡å‡çº§ï¼ˆä¸­æœŸæŒ‘æˆ˜ï¼‰
10. âœ… Level 25: 75 ä¸ª EASY ä»»åŠ¡å‡çº§ï¼ˆé•¿æœŸç›®æ ‡ï¼‰
11. âœ… ä¸‰ç§éš¾åº¦ä»»åŠ¡éƒ½æœ‰ä»·å€¼ï¼ˆHARD ä»ç„¶æœ€å¿«ä½†ä¸æ˜¯å”¯ä¸€é€‰æ‹©ï¼‰

### æ•°æ®å®Œæ•´æ€§
12. âœ… æ‰€æœ‰ç°æœ‰ç”¨æˆ·æ•°æ®æ­£ç¡®è¿ç§»
13. âœ… ç§å­æ•°æ®ä½¿ç”¨æ–°çš„å¥–åŠ±é…ç½®
14. âœ… E2E æµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## ğŸ“ å¤‡æ³¨

### åˆ†æ”¯ç­–ç•¥
- æ‰€æœ‰æ”¹åŠ¨åœ¨ `feature/reward-system-balance` åˆ†æ”¯è¿›è¡Œ
- å®Œæˆååˆå¹¶åˆ° `main` åˆ†æ”¯

### æµ‹è¯•è¦æ±‚
- ä¿®æ”¹å®Œæˆåéœ€è¿è¡Œ E2E æµ‹è¯•éªŒè¯
- å»ºè®®åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯å‡çº§æµç¨‹
- é‡ç‚¹æµ‹è¯•ç­‰çº§è·¨åº¦å’Œ currentXp é‡ç½®é€»è¾‘

### å‘åå…¼å®¹
- ç°æœ‰ç”¨æˆ·æ•°æ®éœ€è¦è¿ç§»
- æä¾› rollback æ–¹æ¡ˆä»¥é˜²é—®é¢˜

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç­‰çº§ç³»ç»Ÿå¯¹æ¯”è¯¦æƒ…](./LEVEL_SYSTEM_COMPARISON.md)
- [é¡¹ç›®éœ€æ±‚æ–‡æ¡£](../.spec-workflow/specs/starship-commander-core/requirements.md)
- [ä»»åŠ¡éš¾åº¦é…ç½®](../src/backend/config/mission-rules.ts)
- [ç­‰çº§ç³»ç»Ÿé…ç½®](../src/backend/config/level-system.ts)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0
**æœ€åæ›´æ–°**: 2025-12-24
**æ›´æ–°å†…å®¹**: æ•´åˆæ¸è¿›å¼ç­‰çº§ç³»ç»Ÿè®¾è®¡
